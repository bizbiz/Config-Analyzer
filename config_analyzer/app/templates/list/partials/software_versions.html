{% extends "list/generic_list.html" %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        filterItems('searchInput', 'softwareVersionsTable', 3);
    });
</script>
{% endblock %}

{% block list_title %}Versions de Logiciels{% endblock %}
{% block list_heading %}
    {% if software %}
        Versions du logiciel {{ software.name }}
    {% else %}
        Liste des Versions de Logiciels
    {% endif %}
{% endblock %}

{% block pre_table_content %}
<div class="mb-4">
    <input type="text" id="searchInput" class="form-control" 
           placeholder="Rechercher une version..." 
           onkeyup="filterItems('searchInput', 'softwareVersionsTable', 3)">
</div>
{% endblock %}

{% block table_headers %}
    <th scope="col">Version</th>
    <th scope="col">Logiciel</th>
    <th scope="col">Utilisée par</th>
    <th scope="col">Actions</th>
{% endblock %}

{% block table_rows %}
    {% for version in items %}
    <tr>
        <td>{{ version.version }}</td>
        <td>{{ version.software.name }}</td>
        <td>
            {% for robot_client in version.robots %}
                <div>{{ robot_client.robot_client.client.name }} - {{ robot_client.robot_client.serial_number }}</div>
            {% else %}
                <span class="text-muted">Aucun client</span>
            {% endfor %}
        </td>
        <td class="text-center">
            <a href="{{ url_for('software_versions.view', 
                      software_name=version.software.name, 
                      version=version.version) }}" 
               class="btn btn-sm btn-info">
                <i class="fas fa-eye"></i>
            </a>
            <a href="{{ url_for('software_versions.edit', 
                      software_name=version.software.name, 
                      version=version.version) }}" 
               class="btn btn-sm btn-warning mx-1">
                <i class="fas fa-edit"></i>
            </a>
            <form action="{{ url_for('software_versions.delete', 
                          software_name=version.software.name, 
                          version=version.version) }}" 
                  method="POST" class="d-inline">
                <button type="submit" class="btn btn-sm btn-danger" 
                        onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette version?')">
                    <i class="fas fa-trash"></i>
                </button>
            </form>
        </td>
    </tr>
    {% endfor %}
{% endblock %}

{% block empty_list_message %}
<div class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i>Aucune version de logiciel trouvée.
    {% if software %}
        <a href="{{ url_for('software_versions.add_for_software', software_name=software.name) }}" class="alert-link">
            Ajouter une version pour {{ software.name }}
        </a>
    {% else %}
        <a href="{{ url_for('software_versions.add') }}" class="alert-link">
            Ajouter une version
        </a>
    {% endif %}
</div>
{% endblock %}

{% block post_table_content %}
<div class="mt-5">
    {% if software %}
        {% include 'add/software_version.html' with context %}
    {% elif all_versions %}
        {% include 'add/software_version.html' with context %}
    {% endif %}
    
    <div class="text-center mt-4">
        <a href="{{ url_for('home.home') }}" class="btn btn-secondary">
            Retour à l'accueil
        </a>
    </div>
</div>
{% endblock %}

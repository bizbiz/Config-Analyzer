{# /app/templates/macros/_entity_sections.html #}
{% from "macros/_table_ui.html" import param_table, alert_empty_list %}

{% macro parameters_section(configured_params, unconfigured_params, entity_type, entity_slug) %}
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fas fa-cogs me-2"></i>Paramètres 
            <span class="badge bg-primary ms-2">{{ configured_params|length + unconfigured_params|length }}</span>
        </h5>
        {% if (configured_params|length + unconfigured_params|length) > 0 %}
        <a href="{{ url_for('additional_params_config.add', entity_type=entity_type, entity_slug=entity_slug) }}" class="btn btn-sm btn-primary">
            <i class="fas fa-plus me-1"></i>Ajouter un paramètre
        </a>
        {% endif %}
    </div>
    <div class="card-body">
        {% if (configured_params|length + unconfigured_params|length) > 0 %}
            {{ param_table(configured_params + unconfigured_params, entity_type, entity_slug, editable=true) }}
        {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>Aucun paramètre défini.
            <a href="{{ url_for('additional_params_config.add', entity_type=entity_type, entity_slug=entity_slug) }}" class="alert-link">
                Ajouter un paramètre
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}


{% macro configurations_section(configurations, entity_type, entity_id) %}
<div class="card mb-5">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fas fa-file-code me-2"></i>Fichiers de configuration
            <span class="badge bg-primary ms-2">{{ configurations|length }}</span>
        </h5>
        {% if configurations|length > 0 %}
        <a href="{{ url_for('configurations.add', entity_type=entity_type, entity_id=entity_id) }}" class="btn btn-sm btn-primary">
            <i class="fas fa-plus me-1"></i>Ajouter une configuration
        </a>
        {% endif %}
    </div>
    <div class="card-body">
        {% if configurations|length > 0 %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Nom du fichier</th>
                        <th>Date</th>
                        <th>Logiciel</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for config in configurations %}
                    <tr>
                        <td>
                            {% if config.file_name %}
                                {{ config.file_name }}
                            {% else %}
                                Configuration #{{ config.id }}
                            {% endif %}
                        </td>
                        <td>{{ config.created_at|datetimeformat('%d/%m/%Y') }}</td>
                        <td>
                            {% if config.software_version %}
                                {{ config.software_version.software.name }} {{ config.software_version.version }}
                            {% else %}
                                Non spécifié
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <a href="{{ url_for('parsed_files.view', config_id=config.id) }}" class="btn btn-sm btn-info me-1">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('configurations.edit', config_id=config.id) }}" class="btn btn-sm btn-warning me-1">
                                <i class="fas fa-edit"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>Aucune configuration enregistrée.
            <a href="{{ url_for('configurations.add', entity_type=entity_type, entity_id=entity_id) }}" class="alert-link">
                Ajouter une configuration
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}
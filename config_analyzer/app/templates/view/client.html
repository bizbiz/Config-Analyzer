{# /app/templates/view/client.html #}
{% extends "view/entity_detail_base.html" %}
{% from "macros/_entity_view_helpers.html" import entity_header, standard_actions, info_card, info_item, stats_card, stats_item %}

{% block entity_title %}Détails du Client : {{ client.name }}{% endblock %}
{% block entity_header %}Détails du Client : {{ client.name }}{% endblock %}

{% block action_buttons %}
<a href="{{ url_for('clients.edit', slug=client.slug) }}" 
   class="btn btn-outline-primary">
    <i class="fas fa-edit"></i> Modifier
</a>
<a href="{{ url_for('additional_params_config.add', entity_type='client', entity_slug=client.slug) }}" 
   class="btn btn-outline-success">
    <i class="fas fa-cog"></i> Ajouter un paramètre
</a>
{% endblock %}

{% block info_content %}
<dt class="col-sm-4">Nom</dt>
<dd class="col-sm-8">{{ client.name }}</dd>

<dt class="col-sm-4">Localisation</dt>
<dd class="col-sm-8">
    {% if client.postal_code_relation %}
        {{ client.postal_code_relation.code }} 
        {{ client.postal_code_relation.city }}, 
        {{ client.postal_code_relation.country_code }}
    {% else %}
        <span class="text-muted">Non renseignée</span>
    {% endif %}
</dd>

<dt class="col-sm-4">Créé le</dt>
<dd class="col-sm-8">{{ client.created_at|datetimeformat('%d/%m/%Y') }}</dd>

<dt class="col-sm-4">Mis à jour le</dt>
<dd class="col-sm-8">{{ client.updated_at|datetimeformat('%d/%m/%Y') }}</dd>
{% endblock %}

{% block stats_content %}
<dt class="col-sm-6">Robots associés</dt>
<dd class="col-sm-6">{{ robots|length }}</dd>

<dt class="col-sm-6">Fichiers configurations</dt>
<dd class="col-sm-6">{{ configurations|length }}</dd>

<dt class="col-sm-6">Paramètres client</dt>
<dd class="col-sm-6">
    {{ configured_params|length }}/{{ configured_params|length + unconfigured_params|length }}
</dd>
{% endblock %}

{% block entity_sections %}
<!-- Section Robots associés -->
<div class="mb-5">
    {% with 
        items=robots,
        title="Robots associés",
        show_add_button=true,
        hide_add_when_empty=false,
        hide_client=true,
        is_embedded=true,
        show_badge=true,
        add_text="Ajouter un robot",
        add_url=url_for('robot_instances.add') + "?client_id=" + client.id|string
    %}
        {% include 'list/partials/robot_instances.html' %}
    {% endwith %}
</div>

<!-- Section Fichiers de configuration -->
<div class="mb-5">
    {% with 
        items=configurations,
        title="Fichiers de configuration",
        show_add_button=true,
        hide_add_when_empty=false,
        is_embedded=true,
        show_badge=true,
        add_text="Ajouter une configuration",
        add_url=url_for('configurations.add', entity_type='client', entity_id=client.id)
    %}
        {% include 'list/partials/configuration_instances.html' %}
    {% endwith %}
</div>

<!-- Section Paramètres -->
<div class="mb-5">
    {% with 
        items=configured_params + unconfigured_params,
        title="Paramètres",
        show_add_button=true,
        hide_add_when_empty=false,
        entity_type='client',
        entity_slug=client.slug,
        is_embedded=true,
        show_badge=true,
        add_text="Ajouter un paramètre"
    %}
        {% include 'list/partials/parameter_definitions.html' %}
    {% endwith %}
</div>
{% endblock %}

{% block back_url %}{{ url_for('clients.list') }}{% endblock %}
{% block back_text %}Retour à la liste{% endblock %}
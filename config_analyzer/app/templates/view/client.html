{# /templates/view/client.html #}
{% extends "base.html" %}
{% from "macros/_table_ui.html" import 
    param_table, 
    card_header, 
    alert_empty_list, 
    display_param_rules,
    display_param_value
%}
{% block title %}Détails du Client : {{ client.name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card p-4 shadow-sm mb-4">
        <h1 class="mb-4">Détails du Client : {{ client.name }}</h1>

        <!-- Section Informations générales -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-info-circle me-2"></i>Informations générales</h5>
                        <dl class="row">
                            <dt class="col-sm-4">Nom</dt>
                            <dd class="col-sm-8">{{ client.name }}</dd>

                            <dt class="col-sm-4">Localisation</dt>
                            <dd class="col-sm-8">
                                {% if client.postal_code_relation %}
                                    {{ client.postal_code_relation.code }} 
                                    {{ client.postal_code_relation.city }}, 
                                    {{ client.postal_code_relation.country_code }}
                                {% else %}
                                    <span class="text-muted">Non renseignée</span>
                                {% endif %}
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- Section Statistiques -->
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-chart-bar me-2"></i>Statistiques</h5>
                        <dl class="row">
                            <dt class="col-sm-6">Robots associés</dt>
                            <dd class="col-sm-6">{{ robots|length }}</dd>

                            <dt class="col-sm-6">Fichiers configurations</dt>
                            <dd class="col-sm-6">{{ configurations|length }}</dd>

                            <dt class="col-sm-6">Paramètres client</dt>
                            <dd class="col-sm-6">
                                {{ configured_params|length }}/{{ configured_params|length + unconfigured_params|length }}
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

        </div>

        <!-- Section Robots associés -->
        {% with 
            items=robots,
            title="Robots associés",
            show_add_button=true,
            hide_add_when_empty=true,
            hide_model=false,
            hide_client=true,
            client=client,
            is_list_view=false,
            show_badge=true
        %}
            {% include 'list/partials/robot_instances.html' %}
        {% endwith %}

        {# Extrait pour fichiers de configuration #}
        {% with 
            items=configurations,
            title="Fichiers de configuration",
            add_url=url_for('configurations.add', entity_type='client', entity_id=client.id),
            add_text="Ajouter une configuration",
            show_add_button=true,
            hide_add_when_empty=true,
            show_badge=true
        %}
            {% include 'list/partials/configuration_instances.html' %}
        {% endwith %}

        <!-- Section Paramètres -->
        {% with 
            items=configured_params + unconfigured_params,
            title="Paramètres spécifiques",
            entity_type='client',
            entity_slug=client.slug,
            add_url=url_for('additional_params_config.add', entity_type='client', entity_slug=client.slug),
            add_text="Ajouter un paramètre",
            show_add_button=true
        %}
            {% include 'list/partials/parameter_definitions.html' %}
        {% endwith %}

    <!-- Actions globales -->
    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
        <a href="{{ url_for('clients.edit', slug=client.slug) }}" 
           class="btn btn-primary me-md-2">
            <i class="fas fa-edit me-2"></i>Modifier la fiche
        </a>
        <a href="{{ url_for('clients.list') }}" 
           class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Retour à la liste
        </a>
    </div>
</div>
{% endblock %}
